{% extends "base.html" %}
{% load humanize %}
{% load md2%}
{% load markdownify %}
{% load comments %}
{% load comments_xtd %}
{% load i18n %}
{% load widget_tweaks %}

{% block title %}Home{% endblock %}

{% block content %}

  <div class="row">
    <div class="col m2 l2"></div>
    <div class="col m7 l7">

        {%if tag%} Topics with {{tag.name}}{% endif %}
        {% if merged_list %}
          {% for post in merged_list.object_list%}

            {% if post.category %}

              <div class="card">
                <div class="card-content">
                    {% for tag in post.tags.all %}
                      <a href="{% url 'discourse:post_list_by_tag' tag.slug  %}"><span class="new badge grey" data-badge-caption="">{{ tag.name }}</span></a>
                    {% endfor %}
                    <h5 class=""><a href="{{post.get_absolute_url}}">{{post.title}} </a></h5>
                    <p class="justify">{{post.summary|truncatechars:300|markdown:"safe, code-friendly, code-color"|linebreaks}}</p>
                  <div class="row">
                    <div class="col m6">Created {{post.created|naturaltime}}</div>
                    <div class="col m4">By <a href="{{post.author.profile.get_absolute_url}}">{{post.author.get_full_name}}</a></div>
                    {% get_comment_count for post as comment_count %}
                    <div class="col m2">
                      {{ comment_count }}
                      <i class="material-icons">comment</i>
                      {{ post.total_likes }}
                      <i class="material-icons">thumb_up</i>
                  </div>
                </div>
            </div>

          </div><!-- End of card -->


          {% else %}

          <div class="card">
            <div class="card-content">
              {% for tag in post.tags.all %}
                <a href="{% url 'debate:debate_list_by_tag' tag.slug  %}"><span class="new badge grey" data-badge-caption="">{{ tag.name }}</span></a>
              {% endfor %}
              <h5 class=""><a href="{{post.get_absolute_url}}">{{post.title}} </a></h5>
              <p class="justify">{{post.summary|truncatechars:300|markdown:"safe, code-friendly, code-color"|linebreaks}}</p>
                <div class="row">
                  <div class="col m3">{% if post.end %} Ends {{post.end|naturaltime}}
                {% elif post.begin %}
                Began {{post.begin|naturaltime}}
                {% else %} Debate starts soon.
              {% endif %}
            </div>

              <div class="col m2">By <a href="{{post.author.profile.get_absolute_url}}">{{post.author.get_full_name}}</a></div>
              <div class="col m5"><strong>Debaters:</strong>
              {% if post.debate_category == "closed" and post.supporting_debaters.all or post.opposing_debaters.all %}
                {% for names in post.supporting_debaters.all %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>,{% endfor %}
                {% for names in post.opposing_debaters.all %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
                {% else %}
                No debaters yet.
              {% endif %}
            </div>

                {% get_comment_count for post as comment_count %}
                <div class="col m2">
                <span>
                  {{ comment_count }}
                  <i class="material-icons">comment</i>
                  {{ post.total_likes }}
                  <i class="material-icons">thumb_up</i
                </span>
              </div>

            </div>
            </div>
          </div><!-- End of card -->

              {% endif %}
          {% endfor %}

          {# The following renders the pagination html #}
          <div id="pagination">
              {{ merged_list.render }}
          </div>


            {% else %}
              <p>There are no posts yet. Check back.</p>
            {% endif %}
  </div>
  <div class="col m3 l3">
    {% if user.is_authenticated %}
    <p>What's your inspiration?</p>
    <a href="{% url 'debate:suggest_post' %}" ><button class="btn">Create a Debate &raquo;</button></a>
    <br/>
    <p>OR</p>
    <a href="{% url 'discourse:new_post' %}" ><button class="btn">Create a Discourse &raquo;</button></a>
    {% endif %}



    {% if last_5_badges %}
    <div class="card">
      <div class="card-content">
        <h5>Latest Badge Winners</h5>
        <p>
        {% for winner in last_5_badges %}
        {% with ''|center:winner.badge.rank as range %}
            {% for _ in range %}<i class="material-icons">star</i></span>{% endfor %}
        {% endwith %}
          {{winner.user.get_full_name}} - {{winner.badge.name}}</p>
        {% endfor %}
      </div>
    </div>
        {% endif %}



    {% get_last_xtdcomments 5 as last_comments for debate.postdebate discourse.post %}
    {% if last_comments %}

    <h6>Latest Comments</h6>
        {% for comment in last_comments %}
        {% if not comment.is_removed %}
        <div class="card">
          <div class="card-content">

          <div id="c{{ comment.id }}" class="media">
          <a name="c{{ comment.id }}"></a>
          <!-- <div class="media-left"><img src="{{ comment.user.profile.image.thumbnail.25x25 }}"/></div> -->
          <div class="media-body">
            <div class="comment">
              <h6 class="media-heading">
                {% trans "Posted to "%}&nbsp;<a href="{{ comment.content_object.get_absolute_url }}">{{ comment.content_object }}</a>&nbsp;-&nbsp;
                {{ comment.submit_date|timesince }}&nbsp;-&nbsp;{% if comment.url and not comment.is_removed %}<a href="{{ comment.url }}" target="_new">{% endif %}{{ comment.name }}{% if comment.url %}</a>{% endif %}&nbsp;&nbsp;<a class="permalink" title="comment permalink" href="{% get_comment_permalink comment %}"><i class="fa fa-share" aria-hidden="true"></i></a>
              </h6>
                {{ comment.comment|truncatechars:150|markdown:"safe, code-friendly, code-color"|linebreaks}}

            </div>
          </div>
          </div>

        </div>
      </div><!-- End of card -->
      {% endif %}
        {% endfor %}

    {% endif %}

  </div>
  </div>




{% endblock %}
