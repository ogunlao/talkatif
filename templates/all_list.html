{% extends "base.html" %}
{% load humanize %}
{% load md2%}
{% load markdownify %}
{% load comments %}
{% load comments_xtd %}
{% load i18n %}
{% load widget_tweaks %}

{% block title %}Home{% endblock %}

{% block content %}

<div class="container-fluid">
  <div class="row">
    <div class="col-md-2"></div>
    <div class="col-md-7">

        {%if tag%} Topics with {{tag.name}}{% endif %}
        {% if merged_list %}
          {% for post in merged_list.object_list%}

            {% if post.category %}

              <div class="panel panel-default">
                <p class="pull-right small">Created: {{post.created|naturaltime}}</p>
                <div class="panel-body">
                    <p>{% for tag in post.tags.all %}
                      <a href="{% url 'discourse:post_list_by_tag' tag.slug  %}"><span class="badge">{{tag.name}}</span></a>
                      {% endfor %}
                    <p>
                    <p class="small">By <a href="{{post.author.profile.get_absolute_url}}">{{post.author.get_full_name}}</a></p>
                    <h4><a href="{{post.get_absolute_url}}">{{post.title}} </a></h4>
                    <p style="text-align:justify">
                      {{ post.summary|truncatewords:70|markdown:"safe, code-friendly, code-color"|linebreaks }}
                    </p>

                  </div>
                  <div class="panel-footer">
                      <ul class="nav nav-pills" role="tablist">
                        <li class="" role="presentation">
                            {% get_comment_count for post as comment_count %}
                            <a href="#"><i class="fa fa-comments"></i><span class="badge">{{ comment_count }}</span></a>
                        </li>
                        <li role="presentation"  class="pull-right">
                          <div class="dropup">
                            <button class="btn btn-default btn-xs dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <span class='fa-stack'><i class='fa fa-square-o fa-stack-2x'></i><i class='fa fa-share-square fa-stack-1x'></i></span>
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                              {% load social_share %}
                              <li>
                                {% post_to_linkedin "Post on {{post.title}} &#13;&#10; {{post.summary}}" object_or_url "<div class='btn'><span class='fa-stack'><i class='fa fa-circle fa-stack-2x'></i><i class='fa fa-linkedin fa-stack-1x fa-inverse'></i></span>linkedIn</div>" %}
                              </li>
                              <li>
                                {% post_to_twitter "Check out: {{post.title}}" object_or_url "<div class='btn'><span class='fa-stack'><i class='fa fa-square-o fa-stack-2x'></i><i class='fa fa-twitter fa-stack-1x'></i></span>twitter</div>" %}
                              </li>

                              <li>
                                {% post_to_facebook  "{{post.get_absolute_url}}" "<div class='btn'><span class='fa-stack'><i class='fa fa-circle fa-stack-2x'></i><i class='fa fa-facebook fa-stack-1x fa-inverse'></i></span>facebook</div>" %}
                              </li>

                                <a href="whatsapp://send?text={{request.get_host}}{{ post.get_absolute_url }}  \n {{post.title}}" data-action="share/whatsapp/share">
                                  <li>&nbsp;&nbsp;&nbsp;<span class='fa-stack'><i class='fa fa-circle fa-stack-2x'></i><i class='fa fa-whatsapp fa-stack-1x fa-inverse'></i></span>WhatAapp
                                  </li>
                                </a>

                                  <!--
                                <script>
                                if (navigator.userAgent.match(/iPhone|Android/i)) {document.write('<li><a href="whatsapp://send?text=See..">Share on WhatApp</a></li>'); }
                                </script>  -->

                            </ul>
                          </div>
                        </li>
                        <ul>

                    </div>

                  </div>


          {% else %}

              <div class="panel panel-default">
                <div class="panel-body">
                    <p class="pull-right small">
                      <i class="fa fa-clock-o fa-lg" aria-hidden="true"><span class="text-muted">
                      {% if post.end %} Ends {{post.end|naturaltime}}
                      {% elif post.begin %}
                      Started {{post.begin|naturaltime}}
                      {% else %} Debate starts soon.
                      {% endif %}
                      </span></i>
                    </p>
                    <p>{% for tag in post.tags.all %}
                      <a href="{% url 'debate:debate_list_by_tag' tag.slug  %}"><span class="badge">{{tag.name}}</span></a>
                      {% endfor %}
                    </p>
                    <p class="small">By <a href="{{post.author.profile.get_absolute_url}}">{{post.author.get_full_name}}</a></p>
                    <h4><a href="{{post.get_absolute_url}}">{{post.title}} </a></h4>
                    <p>
                      {{ post.summary|truncatewords:70|markdown:"safe, code-friendly, code-color"|linebreaks }}
                    </p>
                    <p class="small">Debate Category: {{post.debate_category|capfirst}} Debate</p>
                    <p><strong>Debaters:</strong>
                    {% if post.debate_category == "closed" and post.supporting_debaters.all or post.opposing_debaters.all %}
                      {% for names in post.supporting_debaters.all %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>,{% endfor %}
                      {% for names in post.opposing_debaters.all %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}</p>
                      {% else %}
                      No debaters yet.
                    </p>
                    {% endif %}

                  </div>
                  <div class="panel-footer">
                      <ul class="nav nav-pills" role="tablist">
                        <li class="" role="presentation">
                            {% get_comment_count for post as comment_count %}
                            <a href="#"><i class="fa fa-comments"></i><span class="badge">{{ comment_count }}</span></a>
                        </li>
                        <li role="presentation"  class="pull-right">
                          <div class="dropup">
                            <button class="btn btn-default btn-xs dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <span class='fa-stack'><i class='fa fa-square-o fa-stack-2x'></i><i class='fa fa-share-square fa-stack-1x'></i></span>
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                              {% load social_share %}
                              <li>
                                {% post_to_linkedin "Debate on {{post.title}} &#13;&#10; {{post.summary}}" object_or_url "<div class='btn'><span class='fa-stack'><i class='fa fa-circle fa-stack-2x'></i><i class='fa fa-linkedin fa-stack-1x fa-inverse'></i></span>linkedin</div>" %}
                              </li>
                              <li>
                                {% post_to_twitter "Check out debate on {{post.title}}" object_or_url "<div class='btn'><span class='fa-stack'><i class='fa fa-square-o fa-stack-2x'></i><i class='fa fa-twitter fa-stack-1x'></i></span>twitter</div>" %}
                              </li>

                              <li>
                                {% post_to_facebook  "{{post.get_absolute_url}}" "<div class='btn'><span class='fa-stack'><i class='fa fa-circle fa-stack-2x'></i><i class='fa fa-facebook fa-stack-1x fa-inverse'></i></span>facebook</div>" %}
                              </li>

                                <a href="whatsapp://send?text={{request.get_host}}{{ post.get_absolute_url }}  \n {{post.title}}" data-action="share/whatsapp/share">
                                  <li>&nbsp;&nbsp;&nbsp;<span class='fa-stack'><i class='fa fa-circle fa-stack-2x'></i><i class='fa fa-whatsapp fa-stack-1x fa-inverse'></i></span>Whatsapp
                                  </li>
                                </a>

                                  <!--
                                <script>
                                if (navigator.userAgent.match(/iPhone|Android/i)) {document.write('<li><a href="whatsapp://send?text=See..">Share on WhatApp</a></li>'); }
                                </script>  -->

                            </ul>
                          </div>
                        </li>
                        <ul>

                    </div>

                  </div>

              {% endif %}
          {% endfor %}

          {# The following renders the pagination html #}
          <div id="pagination">
              {{ merged_list.render }}
          </div>


            {% else %}
              <p>There are no posts yet. Check back.</p>
            {% endif %}
  </div>
  <div class="col-md-3">
    {% if user.is_authenticated %}
    <p>What's your inspiration?</p>
    <a href="{% url 'debate:suggest_post' %}" ><button class="btn btn-default">Create a Debate &raquo;</button></a>
    <br/>
    <p>OR</p>
    <a href="{% url 'discourse:new_post' %}" ><button class="btn btn-default">Create a Discourse &raquo;</button></a>
    {% endif %}

    {% if last_5_badges %}
    <h4>Latest Badge Winners</h4>
    <p>
    {% for winner in last_5_badges %}
    {% with ''|center:winner.badge.rank as range %}
        {% for _ in range %}<span class="glyphicon glyphicon-star" aria-hidden="true"></span>{% endfor %}
    {% endwith %}
      {{winner.user.get_full_name}} - {{winner.badge.name}}</p>
    {% endfor %}
    {% endif %}


    {% get_last_xtdcomments 5 as last_comments for debate.postdebate discourse.post %}
    {% if last_comments %}
    <h5>Latest Comments</h5>
    <div class="panel panel-default">
      <div class="panel-body">
        {% for comment in last_comments %}
          <div id="c{{ comment.id }}" class="media">
          <a name="c{{ comment.id }}"></a>
          <!-- <div class="media-left"><img src="{{ comment.user.profile.image.thumbnail.25x25 }}"/></div> -->
          <div class="media-body">
            <div class="comment">
              <h6 class="media-heading">
                {% trans "Posted to "%}&nbsp;<a href="{{ comment.content_object.get_absolute_url }}">{{ comment.content_object }}</a>&nbsp;-&nbsp;
                {{ comment.submit_date|timesince }}&nbsp;-&nbsp;{% if comment.url and not comment.is_removed %}<a href="{{ comment.url }}" target="_new">{% endif %}{{ comment.name }}{% if comment.url %}</a>{% endif %}&nbsp;&nbsp;<a class="permalink" title="comment permalink" href="{% get_comment_permalink comment %}"><i class="fa fa-share" aria-hidden="true"></i></a>
              </h6>
              {% if not comment.is_removed %}
                {{ comment.comment|truncatechars:150|markdown:"safe, code-friendly, code-color"|linebreaks}}
              {% endif %}
            </div>
          </div>
          </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

  </div>
  </div>
</div>



{% endblock %}
