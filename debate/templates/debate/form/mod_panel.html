{% extends "debate/base.html" %}
{% load staticfiles %}
{% load widget_tweaks %}

{% block title %}Mod Panel{% endblock %}

{% block content %}

      <h3>Debate Period for: <br>
        <a href="{{related_post.get_absolute_url}}">{{related_post.title|capfirst}}</a> </h3>
          {% if debaters_supporting or debaters_opposing %}
          <div class="ui fluid card">
            {% if debaters_supporting %}
                <div class="content">
                  <div class="header">List of Debaters Showing Interest in Supporting</div>
                  <div class="meta">Approve 5 or less debaters from this category based on your choice.</div>
                  <table class="ui fluid table">
                    <thead>
                      <tr>
                        <th>Name</th>
                        <th>Username</th>
                        <th>Specialization</th>
                        <th>Add</th>
                        <th>Remove</th>
                        <th>Approval Status</th>
                    </tr>
                    </thead>
                    <tbody>
                      {% for debaters in debaters_supporting %}
                      <tr>
                        <td>{{debaters.name.get_full_name}}</td>
                        <td>{{debaters.name.username}}</td>
                        <td>{{debaters.name.profile.specialization}}</td>
                        <td><a class="btn-floating blue waves-effect approve {{debaters.name.username}}" name="{{debaters.name.id}}" value="{{debaters.post.id}}" position="{{debaters.debate_position}}" approve="yes"><i class="material-icons">add</i></a></td>
                        <td><a class="btn-floating red waves-effect approve {{debaters.name.username}}" name="{{debaters.name.id}}" value="{{debaters.post.id}}" position="{{debaters.debate_position}}" approve="no"><i class="material-icons">remove</i></a></td>
                        <td id="approval-{{debaters.name.username}}">
                          {% if debaters.approval_status == True %}
                            approved
                          {% elif debaters.approval_status == False %}
                            not approved
                          {% endif %}
                        </td>
                      </tr>
                        {% endfor %}
                  </tbody>
                  </table>
                </div>
            {% endif %}

            {% if debaters_opposing %}
              <div class="content">List of Debaters Showing Interest in Opposing

                <div class="meta">Approve 5 or less debaters from this category based on your choice.</div>
                <table class="ui fluid table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Username</th>
                      <th>Add</th>
                      <th>Remove</th>
                      <th>Approval Status</th>
                  </tr>
                  </thead>
                  <tbody>
                    {% for debaters in debaters_opposing %}
                    <tr>
                      <td>{{debaters.name.get_full_name}}</td>
                      <td>{{debaters.name.username}}</td>
                      <td>{{debaters.name.profile.specialization}}</td>
                      <td><button class="btn-floating blue waves-effect approve {{debaters.name.username}}" name="{{debaters.name.id}}" value="{{debaters.post.id}}" position="{{debaters.debate_position}}" approve="yes">Approve</button></td>
                      <td><button class="btn-floating red waves-effect approve {{debaters.name.username}}" name="{{debaters.name.id}}" value="{{debaters.post.id}}" position="{{debaters.debate_position}}" approve="no">Disapprove</button></td>
                      <td id="approval-{{debaters.name.username}}">
                        {% if debaters.approval_status == True %}
                          approved
                        {% elif debaters.approval_status == False %}
                          not approved
                        {% endif %}
                      </td>
                    </tr>
                      {% endfor %}
                </tbody>
                </table>
            </div>
            {% endif %}

          </div><!--  End of card -->
          {% else %}

            {% if related_post.debate_category == "closed" %}
              <p>No person has indicated interest in debate yet. Share debate on social media to get the attention it deserves </p>
            {% endif %}

          {% endif %}

          <div class="ui fluid card">
            <div class="content">

                <form class="ui fluid form" action="." method="post">
                  {% csrf_token %}
                    <!-- Switch to allow comments -->
                    <div class="inline field">
                      <div class="ui toggle checkbox">
                        <input type="checkbox" {% if related_post.allow_follower_comment %}checked {% endif %} name="allow_follower_comment">
                        <label>Allow comments from observers after debate ends.</label>
                      </div>
                    </div>

                    <div class="three column fields">
                      <div class='field {% if mod_form.begin.errors %}error{% endif %}'>
                        <label>Debate Start Date/Time</label>
                        <i class="checked calendar icon"></i>
                        {% render_field mod_form.begin class+="datetimepicker" %}
                        {% if mod_form.end.errors %}{{errors}}{% endif %}
                      </div>

                      <div class='field {% if mod_form.vote_starts.errors %}error{% endif %}'>
                        <label>Vote Start Date/Time</label>
                        <i class="checked calendar icon"></i>
                        {% render_field mod_form.vote_starts class+="datetimepicker" %}
                        {% if mod_form.vote_starts.errors %}{{errors}}{% endif %}
                      </div>

                      <div class='field {% if mod_form.end.errors %}error{% endif %}'>
                        <label>Debate End Date/Time</label>
                        <i class="checked calendar icon"></i>
                        {% render_field mod_form.end class+="datetimepicker" %}
                        {% if mod_form.end.errors %}{{errors}}{% endif %}
                      </div>
                    </div>

                      <br>
                      <small class="red text">N.B: Votes or scores would not be counted after this end time.</small>

                  <div class="inline field">
                    <div class="ui checkbox">
                      <input type="checkbox" id="verified" required tabindex="0" class="hidden">
                      <label for="verified">I have read the <a href="{% url 'debate:rules_guidelines' %}">terms of moderation</a> and understand what I am doing.</label>
                    </div>
                  </div>

                  <button type="submit" value="Update" class="ui basic secondary button">Update Debate Settings</button> Or <small>Return to <a href="{{related_post.get_absolute_url }}">debate</a></small>
                  <hr>

                  <small>Only edit necessary fields. Do not tamper with debate settings if unsure
                  We believe you have discussed with co-moderators(if any) before changing settings.
                  <small>
                </form>
          </div>

          </div>

    {% block extra-js %}

    <script>
    $('.approve').click(function(){
          $.ajax({
                   type: "POST",
                   url: "{% url 'debate:approve' %}",
                   data: {'user_id': $(this).attr('name'), 'csrfmiddlewaretoken': '{{ csrf_token }}', 'post_id':$(this).attr('value'), 'position':$(this).attr('position'), 'approve':$(this).attr('approve') },
                   dataType: "json",
                   success: function(response) {
                          //alert(response.message);
                          if (response.approved == 1){
                            $("td#approval-"+response.username).text("approved");
                          }else{
                              $("td#approval-"+response.username).text("not approved");
                          };

                    },
                    error: function(rs, e) {
                           alert(rs.responseText);
                    }
              });
    });
</script>
{% endblock extra-js %}


{% endblock %}
