{% extends "debate/base.html" %}
{% load humanize %}
{% load md2 %}
{% load widget_tweaks %}
{% load markdownify %}
{% load comments %}
{% load comments_xtd %}
{% load i18n %}


{% block title %}Debate{% endblock %}

{% block content %}

<div class="row">
  <div class="col m2 l2">
    {% if tag %}
    <div class="row">
      <br><br> Results for:
      <a href="{% url 'debate:debate_list_by_tag' tag.slug  %}"><span class="new badge grey" data-badge-caption="">{{ tag.name }}</span></a>
    </div>
    {% endif %}
  </div>
  <div class="col m7 l7">
  {% if object_list %}

        {% for post in object_list.object_list %}
        <!-- Card Projects -->
        <div class="card">
          <div class="card-content">
            {% for tag in post.tags.all %}
              <a href="{% url 'debate:debate_list_by_tag' tag.slug  %}"><span class="new badge grey" data-badge-caption="">{{ tag.name }}</span></a>
            {% endfor %}
            <h5 class=""><a href="{{post.get_absolute_url}}">{{post.title}}</a></h5>
            <p>{{post.summary|truncatechars:300|markdown:"safe, code-friendly, code-color"|linebreaks}}</p>
            {% if post.end %} Ends {{post.end|naturaltime}}
              {% elif post.begin %}
              Began {{post.begin|naturaltime}}
              {% else %} Debate starts soon.
            {% endif %}

            <p>By <a href="{{post.author.profile.get_absolute_url}}">{{post.author.get_full_name}}</a></p>
            <p><strong>Debaters:</strong>
            {% if post.debate_category == "closed" and post.supporting_debaters.all or post.opposing_debaters.all %}
              {% for names in post.supporting_debaters.all %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>,{% endfor %}
              {% for names in post.opposing_debaters.all %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
              {% else %}
              No debaters yet.
            {% endif %}

              {% get_comment_count for post as comment_count %}
              <span class="right">
                {{ comment_count }}
                <i class="material-icons">comment</i>
                {{ post.total_likes }}
                <i class="material-icons">thumb_up</i>
              </span>
            </p>
          </div>
        </div><!-- End of card -->
        {% endfor %}



        <!-- The following renders the pagination html -->
        <div>
            {{ object_list.render }}
        </div>

  {% else %}
    <p>There are no debates started yet. Create a new debate below.</p>
  {% endif %}

    {% if user.is_authenticated %}
          <div class="card">
            <div class="card-content">
              <p>Create a new debate.</p>
              <form method="post" action="{% url 'debate:suggest_post' %}">
                {% csrf_token %}
                {% for field in form %}

                <div class="row">
                  <div class="input-field col l12">
                    {% if field.name == "summary" %}
                    {{ field|attr:"class:materialize-textarea"}}
                    {% elif field.name == "attachment" %}
                    <div class="file-field input-field">
                      <div class="btn">
                        <span>File</span>
                        <input accept="image/*" id="id_attachment" multiple="multiple" name="attachment" type="file">
                      </div>
                      <div class="file-path-wrapper">
                        <input class="file-path validate" type="text">
                      </div>
                    </div>
                    {% elif field.name == "tags"  %}

                    <div class="chips chips-placeholder">
                      Tag<i class="close material-icons">close</i>
                    </div>


                    {% else %}
                    <div class="input-field">
                      {{ field}}
                    </div>
                    {% endif %}
                    <!-- <label for="field.name">{{field.label_tag}}</label> -->
                    <p>
                      {% if field.name == "tags" %}
                        <small class="grey-text">Input a tag and press enter to accept e.g. music, politics</small>
                      {% elif field.help_text %}
                          <small class="grey-text">{{ field.help_text|markdownify }}</small>
                      {% endif %}
                      {% for errror in field.errors %}
                      <strong class="red-text">{{ error|escape }}</strong>
                      {% endfor %}
                    </p>
                  </div>

                </div>

              {% endfor %}
                <button class="btn" type="submit">Post Debate &raquo;</button>
              </form>

        </div>
      </div><!-- End of Card -->
      {% endif %}

    </div><!-- End of main div   -->

  <div class="col m3 l3">
    <p>
      <a href="{% url 'debate:suggest_post' %}">
    <button class="btn btn-primary">Post a Debate</button></a>
    </p>
    <br>

    <!--
    <h4>Top Debaters</h4>
    <p>To be attended to
      <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
      <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
      <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
      <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
    </p>
    <p >Use aggregate</p><p>Fusce dapibus, tellu</p><p>tortor mauris</p>

    <br/> -->

    {% if last_5_badges %}
    <div class="card">
      <div class="card-content">
        <h4>Latest Badge Winners</h4>
        {% for winner in last_5_badges %}
          <p>
            {% with ''|center:winner.badge.rank as range %}
                {% for _ in range %}<i class="material-icons">star</i>{% endfor %}
            {% endwith %}
            {{winner.user.get_full_name}} - {{winner.badge.name}}</p>
        {% endfor %}
        <p>Enter for a debate to get your first badge<p>
          <br/>
      </div>
    </div>
    {% endif %}



    {% get_last_xtdcomments 5 as last_comments for debate.postdebate %}
    {% if last_comments %}
    <h6>Latest Comments</h6>
        {% for comment in last_comments %}
        {% if not comment.is_removed %}
        <div class="card">
          <div class="card-content">

          <div id="c{{ comment.id }}" class="media">
          <a name="c{{ comment.id }}"></a>
          <!-- <div class="media-left"><img src="{{ comment.user.profile.image.thumbnail.25x25 }}"/></div> -->
            <div class="comment">
              <small>
                {% trans "Posted to "%}&nbsp;<a href="{{ comment.content_object.get_absolute_url }}">{{ comment.content_object }}</a>&nbsp;-&nbsp;
                {{ comment.submit_date|timesince }}&nbsp;by &nbsp;{% if comment.url and not comment.is_removed %}<a href="{{ comment.url }}" target="_new">{% endif %}{{ comment.name }}{% if comment.url %}</a>{% endif %}&nbsp;&nbsp;<a class="permalink" title="comment permalink" href="{% get_comment_permalink comment %}"><i class="fa fa-share" aria-hidden="true"></i></a>
              </small>
                {{ comment.comment|truncatechars:150|markdown:"safe, code-friendly, code-color"|linebreaks}}

            </div>
          </div>

        </div>
      </div><!-- End of card -->
      {% endif %}
        {% endfor %}

    {% endif %}


 </div>
</div>

<script>
//Init for chips for tags
$(document).ready(function() {
$('.chips-placeholder').material_chip({
    placeholder: 'Enter a tag',
    secondaryPlaceholder: 'Enter another tag',
  });
});
</script>


{% endblock %}
