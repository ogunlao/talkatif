{% extends "debate/base.html" %}
{% load humanize %}
{% load markdownify %}
{% load comments %}
{% load comments_xtd %}
{% load i18n %}
{% load avatar_tags %}
{% load staticfiles %}

{% block title %}Debate{% endblock %}

{% block content %}

    {% if tag %}
      Results for:
      <a href="{% url 'debate:debate_list_by_tag' tag.slug  %}" class="ui blue basic label">{{ tag.name }}</a>
    {% endif %}

    {% if object_list %}

          {% for post in object_list.object_list %}
          <!-- Card Projects -->
          <div class="ui fluid card">
            <div class="content">
              <div class="right floated meta">{{post.created|naturaltime}}</div>
              <a href="{{post.author.profile.get_absolute_url}}">
                {% if post.author|has_avatar %}
                  {% avatar post.author 35 class="ui avatar image" %}
                {% else %}
                  <img src="{{names.profile.profile_image_url}}" class="ui avatar image" width="35" height="35" />
                {% endif %}
                {{post.author.get_full_name}}</a>
            </div>
            <div class="content">
              <div class="header"><a href="{{post.get_absolute_url}}">{{post.title}}</a></div>
              <div class="meta"><i class="hourglass start icon"></i> {{post.begin|naturaltime}}</div>
              <div class="meta">
                {% for tag in post.tags.all %}
                <a href="{% url 'debate:debate_list_by_tag' tag.slug  %}" class="ui blue basic label">{{ tag.name }}</a>
                {% endfor %}
                <br>
              </div>
              <div class="description">
                {{post.summary|truncatechars:300|markdownify}}
              </div>
            </div>
            <div class="content">
              <span class="right floated">
                <i class="heart outline like icon"></i>
                {{ post.total_likes }} like{{ post.total_likes|pluralize }}
              </span>
              <i class="comment icon"></i>
              {% get_comment_count for post as comment_count %}
              {{ comment_count }} comment{{ comment_count|pluralize }}
            </div>
            <div class="extra content">
              <i class="users icon"></i>
              {% if post.debate_category == "closed" and post.supporting_debaters.all or post.opposing_debaters.all %}
                {% for names in post.supporting_debaters.all %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>{% endfor %}
                {% for names in post.opposing_debaters.all %}{% if forloop.first %}, {% endif %} <a href="{{names.profile.get_absolute_url}}">{{ names.get_full_name }}</a>{% if not forloop.last %}, {% endif %}{% endfor %}
                {% else %}
                No debaters yet.
              {% endif %}
            </div>
          </div>

        {% endfor %}

        <!-- The following renders the pagination html -->
        <div>
          {% if object_list.object_list %}
            {{ object_list.render }}
          {% endif %}
        </div>
  {% endif %}
  {% if not object_list.object_list %}
    <p>There are no debates started yet. Create a new debate or checkback.</p>
  {% endif %}

{% endblock content %}
{% block right_content %}

    <a href="{% url 'debate:suggest_post' %}">
      <button class="ui secondary basic button">New Debate</button>
    </a>

  <br>

  <!--
  <h4>Top Debaters</h4>
  <p>To be attended to
    <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
    <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
    <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
    <span class="glyphicon glyphicon-star" aria-hidden="true"></span>
  </p>
  <p >Use aggregate</p><p>Fusce dapibus, tellu</p><p>tortor mauris</p>

  <br/> -->

  {% if last_5_badges %}
      <h4>Latest Badge Winners</h4>
      {% for winner in last_5_badges %}
        <p>
          {% with ''|center:winner.badge.rank as range %}
              {% for _ in range %}<i class="ui heart rating"></i>{% endfor %}
          {% endwith %}
          {{winner.user.get_full_name}} - {{winner.badge.name}}</p>
      {% endfor %}
      <p>Enter for a debate to get your first badge<p>
        <br/>
  {% endif %}

{% endblock right_content %}
